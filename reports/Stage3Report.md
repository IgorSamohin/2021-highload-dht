# Stage 2 Report

## Нагрузочное тестирование `PUT`-запросами

```bash
wrk -c 64 -t 16 -d5m -R 50000 -L -s scripts/put.lua http://localhost:8080
```

### CPU

```bash
 ./profiler.sh -e cpu -d 270 -f putCpuConcurrentServer.html 18010
```

### Alloc

```bash
 ./profiler.sh -e alloc -d 270 -f putAllocConcurrentServer.html 18010
```

### Lock

```bash
 ./profiler.sh -e lock -d 270 -f putLockConcurrentServer.html 18010
```

## Нагрузочное тестирование `GET`-запросами

```bash
wrk -c 64 -t 16 -d5m -R 50000 -L -s scripts/get.lua http://localhost:8080
```

### CPU

```bash
 ./profiler.sh -e cpu -d 270 -f getCpuConcurrentServer.html 18010
```

### Alloc

```bash
 ./profiler.sh -e alloc -d 270 -f getAllocConcurrentServer.html 18010
```

### Lock

```bash
 ./profiler.sh -e lock -d 270 -f getLockConcurrentServer.html 18010
```

## Результаты

### PUT

```text 
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     4.65ms   22.53ms 430.34ms   97.80%
    Req/Sec     3.30k   574.59    13.89k    83.12%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.41ms
 75.000%    2.03ms
 90.000%    3.46ms
 99.000%  118.72ms
 99.900%  296.45ms
 99.990%  376.06ms
 99.999%  413.44ms
100.000%  430.59ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.050     0.000000            2         1.00
       0.616     0.100000      1454406         1.11
       0.845     0.200000      2901540         1.25
       1.040     0.300000      4355255         1.43
       1.224     0.400000      5803952         1.67
       1.412     0.500000      7253753         2.00
       1.512     0.550000      7976988         2.22
       1.619     0.600000      8702732         2.50
       1.736     0.650000      9424062         2.86
       1.871     0.700000     10151963         3.33
       2.033     0.750000     10873788         4.00
       2.133     0.775000     11238474         4.44
       2.251     0.800000     11598614         5.00
       2.401     0.825000     11961153         5.71
       2.605     0.850000     12324026         6.67
       2.915     0.875000     12685188         8.00
       3.147     0.887500     12865817         8.89
       3.463     0.900000     13046737        10.00
       3.891     0.912500     13228091        11.43
       4.463     0.925000     13409901        13.33
       5.239     0.937500     13591016        16.00
       5.747     0.943750     13681365        17.78
       6.387     0.950000     13771571        20.00
       7.247     0.956250     13862216        22.86
       8.527     0.962500     13953113        26.67
      10.871     0.968750     14043586        32.00
      13.127     0.971875     14088722        35.56
      17.471     0.975000     14133995        40.00
      27.615     0.978125     14179312        45.71
      46.623     0.981250     14224572        53.33
      70.463     0.984375     14269910        64.00
      83.135     0.985938     14292609        71.11
      96.191     0.987500     14315212        80.00
     110.079     0.989062     14337841        91.43
     124.735     0.990625     14360559       106.67
     142.079     0.992188     14383162       128.00
     153.215     0.992969     14394531       142.22
     167.167     0.993750     14405771       160.00
     181.759     0.994531     14417143       182.86
     198.911     0.995313     14428475       213.33
     216.319     0.996094     14439822       256.00
     224.127     0.996484     14445457       284.44
     232.703     0.996875     14451078       320.00
     243.327     0.997266     14456789       365.71
     253.951     0.997656     14462451       426.67
     264.191     0.998047     14468170       512.00
     270.335     0.998242     14470919       568.89
     276.991     0.998437     14473825       640.00
     283.391     0.998633     14476576       731.43
     290.047     0.998828     14479429       853.33
     297.727     0.999023     14482294      1024.00
     302.335     0.999121     14483670      1137.78
     307.199     0.999219     14485057      1280.00
     312.319     0.999316     14486463      1462.86
     318.463     0.999414     14487912      1706.67
     324.863     0.999512     14489324      2048.00
     328.447     0.999561     14490001      2275.56
     332.287     0.999609     14490715      2560.00
     336.383     0.999658     14491435      2925.71
     340.479     0.999707     14492156      3413.33
     345.087     0.999756     14492858      4096.00
     347.903     0.999780     14493199      4551.11
     351.231     0.999805     14493540      5120.00
     355.839     0.999829     14493906      5851.43
     360.191     0.999854     14494257      6826.67
     366.847     0.999878     14494612      8192.00
     373.247     0.999890     14494782      9102.22
     376.831     0.999902     14494958     10240.00
     380.671     0.999915     14495144     11702.86
     384.511     0.999927     14495309     13653.33
     389.119     0.999939     14495489     16384.00
     391.423     0.999945     14495574     18204.44
     393.471     0.999951     14495672     20480.00
     395.519     0.999957     14495753     23405.71
     397.567     0.999963     14495841     27306.67
     400.639     0.999969     14495928     32768.00
     402.431     0.999973     14495972     36408.89
     404.479     0.999976     14496020     40960.00
     406.271     0.999979     14496064     46811.43
     407.807     0.999982     14496111     54613.33
     409.087     0.999985     14496149     65536.00
     410.367     0.999986     14496174     72817.78
     411.391     0.999988     14496197     81920.00
     412.671     0.999989     14496218     93622.86
     414.719     0.999991     14496238    109226.67
     416.511     0.999992     14496263    131072.00
     417.279     0.999993     14496274    145635.56
     418.303     0.999994     14496282    163840.00
     419.583     0.999995     14496293    187245.71
     421.631     0.999995     14496305    218453.33
     423.679     0.999996     14496316    262144.00
     424.447     0.999997     14496323    291271.11
     424.703     0.999997     14496326    327680.00
     425.727     0.999997     14496333    374491.43
     425.983     0.999998     14496338    436906.67
     426.495     0.999998     14496345    524288.00
     426.751     0.999998     14496349    582542.22
     426.751     0.999998     14496349    655360.00
     427.007     0.999999     14496351    748982.86
     427.519     0.999999     14496356    873813.33
     427.775     0.999999     14496358   1048576.00
     427.775     0.999999     14496358   1165084.44
     428.031     0.999999     14496359   1310720.00
     428.543     0.999999     14496361   1497965.71
     428.799     0.999999     14496363   1747626.67
     429.055     1.000000     14496364   2097152.00
     429.055     1.000000     14496364   2330168.89
     429.567     1.000000     14496366   2621440.00
     429.567     1.000000     14496366   2995931.43
     429.567     1.000000     14496366   3495253.33
     430.079     1.000000     14496367   4194304.00
     430.079     1.000000     14496367   4660337.78
     430.335     1.000000     14496369   5242880.00
     430.335     1.000000     14496369   5991862.86
     430.335     1.000000     14496369   6990506.67
     430.335     1.000000     14496369   8388608.00
     430.335     1.000000     14496369   9320675.55
     430.335     1.000000     14496369  10485760.00
     430.335     1.000000     14496369  11983725.71
     430.335     1.000000     14496369  13981013.34
     430.591     1.000000     14496370  16777216.00
     430.591     1.000000     14496370          inf
#[Mean    =        4.647, StdDeviation   =       22.527]
#[Max     =      430.336, Total count    =     14496370]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  14996968 requests in 5.00m, 0.94GB read
Requests/sec:  50004.65
Transfer/sec:      3.20MB
```

### GET

```text
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    11.33ms   51.50ms 602.11ms   97.00%
    Req/Sec     3.31k     0.87k   11.11k    75.55%
  Latency Distribution (HdrHistogram - Recorded Latency)
 50.000%    1.94ms
 75.000%    3.96ms
 90.000%    9.29ms
 99.000%  347.39ms
 99.900%  528.38ms
 99.990%  567.81ms
 99.999%  595.46ms
100.000%  602.62ms

  Detailed Percentile spectrum:
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.073     0.000000            1         1.00
       0.797     0.100000      1451057         1.11
       1.082     0.200000      2900443         1.25
       1.344     0.300000      4352867         1.43
       1.620     0.400000      5803692         1.67
       1.944     0.500000      7248977         2.00
       2.149     0.550000      7978547         2.22
       2.405     0.600000      8698362         2.50
       2.757     0.650000      9423165         2.86
       3.257     0.700000     10148597         3.33
       3.961     0.750000     10874133         4.00
       4.411     0.775000     11237820         4.44
       4.947     0.800000     11599734         5.00
       5.603     0.825000     11961079         5.71
       6.447     0.850000     12323117         6.67
       7.595     0.875000     12685231         8.00
       8.351     0.887500     12866353         8.89
       9.287     0.900000     13047425        10.00
      10.487     0.912500     13228869        11.43
      12.135     0.925000     13409688        13.33
      14.783     0.937500     13590854        16.00
      16.863     0.943750     13681791        17.78
      19.983     0.950000     13772228        20.00
      25.375     0.956250     13862822        22.86
      35.583     0.962500     13953395        26.67
      56.351     0.968750     14043860        32.00
      74.623     0.971875     14089224        35.56
      99.711     0.975000     14134515        40.00
     132.095     0.978125     14179769        45.71
     164.863     0.981250     14225225        53.33
     209.919     0.984375     14270381        64.00
     244.991     0.985938     14293024        71.11
     281.599     0.987500     14315795        80.00
     322.815     0.989062     14338328        91.43
     361.983     0.990625     14361045       106.67
     394.239     0.992188     14383761       128.00
     409.343     0.992969     14394949       142.22
     422.655     0.993750     14406350       160.00
     440.575     0.994531     14417685       182.86
     455.167     0.995313     14428970       213.33
     469.759     0.996094     14440395       256.00
     476.159     0.996484     14445943       284.44
     483.071     0.996875     14451801       320.00
     489.471     0.997266     14457344       365.71
     496.895     0.997656     14463054       426.67
     506.111     0.998047     14468605       512.00
     510.719     0.998242     14471576       568.89
     515.071     0.998437     14474379       640.00
     519.423     0.998633     14477211       731.43
     523.775     0.998828     14479991       853.33
     528.895     0.999023     14482768      1024.00
     531.967     0.999121     14484379      1137.78
     534.527     0.999219     14485681      1280.00
     537.599     0.999316     14487112      1462.86
     540.159     0.999414     14488391      1706.67
     543.743     0.999512     14489988      2048.00
     545.279     0.999561     14490529      2275.56
     547.839     0.999609     14491356      2560.00
     549.887     0.999658     14491927      2925.71
     552.447     0.999707     14492725      3413.33
     554.495     0.999756     14493422      4096.00
     555.519     0.999780     14493699      4551.11
     557.055     0.999805     14494049      5120.00
     559.103     0.999829     14494431      5851.43
     562.175     0.999854     14494766      6826.67
     564.735     0.999878     14495149      8192.00
     566.271     0.999890     14495320      9102.22
     568.319     0.999902     14495476     10240.00
     573.439     0.999915     14495638     11702.86
     578.047     0.999927     14495827     13653.33
     580.607     0.999939     14495996     16384.00
     582.143     0.999945     14496104     18204.44
     583.167     0.999951     14496185     20480.00
     584.703     0.999957     14496265     23405.71
     585.727     0.999963     14496349     27306.67
     587.775     0.999969     14496464     32768.00
     588.287     0.999973     14496505     36408.89
     588.799     0.999976     14496525     40960.00
     590.335     0.999979     14496575     46811.43
     591.359     0.999982     14496624     54613.33
     592.383     0.999985     14496663     65536.00
     592.895     0.999986     14496679     72817.78
     593.919     0.999988     14496705     81920.00
     594.943     0.999989     14496723     93622.86
     595.967     0.999991     14496746    109226.67
     596.479     0.999992     14496766    131072.00
     596.991     0.999993     14496780    145635.56
     597.503     0.999994     14496799    163840.00
     597.503     0.999995     14496799    187245.71
     598.527     0.999995     14496811    218453.33
     599.039     0.999996     14496828    262144.00
     599.039     0.999997     14496828    291271.11
     599.551     0.999997     14496842    327680.00
     599.551     0.999997     14496842    374491.43
     599.551     0.999998     14496842    436906.67
     600.063     0.999998     14496850    524288.00
     600.575     0.999998     14496854    582542.22
     600.575     0.999998     14496854    655360.00
     601.087     0.999999     14496860    748982.86
     601.087     0.999999     14496860    873813.33
     601.599     0.999999     14496868   1048576.00
     601.599     0.999999     14496868   1165084.44
     601.599     0.999999     14496868   1310720.00
     601.599     0.999999     14496868   1497965.71
     601.599     0.999999     14496868   1747626.67
     602.111     1.000000     14496874   2097152.00
     602.111     1.000000     14496874   2330168.89
     602.111     1.000000     14496874   2621440.00
     602.111     1.000000     14496874   2995931.43
     602.111     1.000000     14496874   3495253.33
     602.111     1.000000     14496874   4194304.00
     602.111     1.000000     14496874   4660337.78
     602.111     1.000000     14496874   5242880.00
     602.111     1.000000     14496874   5991862.86
     602.111     1.000000     14496874   6990506.67
     602.111     1.000000     14496874   8388608.00
     602.111     1.000000     14496874   9320675.55
     602.111     1.000000     14496874  10485760.00
     602.111     1.000000     14496874  11983725.71
     602.111     1.000000     14496874  13981013.34
     602.623     1.000000     14496875  16777216.00
     602.623     1.000000     14496875          inf
#[Mean    =       11.329, StdDeviation   =       51.504]
#[Max     =      602.112, Total count    =     14496875]
#[Buckets =           27, SubBuckets     =         2048]
----------------------------------------------------------
  14997398 requests in 5.00m, 2.41GB read
  Non-2xx or 3xx responses: 2
Requests/sec:  50002.50
Transfer/sec:      8.24MB

```

## Профилировщик

|     | CPU | Alloc | Lock |
| --- | --- | ----- | ---- |
| GET | [ссылка](https://htmlpreview.github.io/?https://github.com/IgorSamohin/2021-highload-dht/blob/igor-samokhin-content/graphs/stage2/getCpuConcurrentServer.html) | [ссылка](https://htmlpreview.github.io/?https://github.com/IgorSamohin/2021-highload-dht/blob/igor-samokhin-content/graphs/stage2/getAllocConcurrentServer.html) | [ссылка](https://htmlpreview.github.io/?https://github.com/IgorSamohin/2021-highload-dht/blob/igor-samokhin-content/graphs/stage2/getLockConcurrentServer.html) |   
| PUT | [ссылка](https://htmlpreview.github.io/?https://github.com/IgorSamohin/2021-highload-dht/blob/igor-samokhin-content/graphs/stage2/putCpuConcurrentServer.html) | [ссылка](https://htmlpreview.github.io/?https://github.com/IgorSamohin/2021-highload-dht/blob/igor-samokhin-content/graphs/stage2/putAllocConcurrentServer.html) | [ссылка](https://htmlpreview.github.io/?https://github.com/IgorSamohin/2021-highload-dht/blob/igor-samokhin-content/graphs/stage2/putLockConcurrentServer.html) |

## Выводы

